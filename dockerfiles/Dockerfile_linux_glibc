FROM 037803949979.dkr.ecr.us-west-1.amazonaws.com/centos-base:latest

COPY . /go/src/github.com/confluentinc/cli/

COPY .netrc /root/.netrc
RUN chmod 600 /root/.netrc
RUN export GO_VERSION=$(cat /cli/.go-version) && \
    wget "https://go.dev/dl/go${GO_VERSION}.linux-amd64.tar.gz" && \
    sudo tar -C /usr/local -xzf "go${GO_VERSION}.linux-amd64.tar.gz"

ENV PATH=${PATH}:/usr/local/go/bin:/root/go/bin

RUN go install github.com/goreleaser/goreleaser@v1.16.3-0.20230323115904-f82a32cd3a59

RUN cd /go/src/github.com/confluentinc/cli && \
    make gorelease-linux-glibc

RUN cd /go/src/github.com/confluentinc/cli && \
    for file in dist/*linux*; do mv -v "$file" "${file/linux/linux}"; done ; \
    for file in dist/*.txt; do mv -v "$file" "${file/checksums/checksums_linux}"; done;
