project_name: ccloud

before:
  hooks:
    # to avoid goreleaser error due to `make deps` on CI: git is currently in a dirty state
    - git checkout go.mod

builds:
  -
    binary: ccloud
    main: .
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}  -X main.host={{.Env.HOSTNAME}}
    gcflags:
      - -trimpath={{.Env.GOPATH}}
    asmflags:
      - -trimpath={{.Env.GOPATH}}
    goos:
      - linux
      - darwin
      - windows
    goarch:
      - amd64
      - 386
    ignore:
      - goos: darwin
        goarch: 386
  -
    binary: ccloud-kafka-plugin
    main: ./plugin/ccloud-kafka-plugin
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}  -X main.host={{.Env.HOSTNAME}}
    gcflags:
      - -trimpath={{.Env.GOPATH}}
    asmflags:
      - -trimpath={{.Env.GOPATH}}
    goos:
      - linux
      - darwin
      - windows
    goarch:
      - amd64
      - 386
    ignore:
      - goos: darwin
        goarch: 386
  -
    binary: ccloud-connect-plugin
    main: ./plugin/ccloud-connect-plugin
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}  -X main.host={{.Env.HOSTNAME}}
    gcflags:
      - -trimpath={{.Env.GOPATH}}
    asmflags:
      - -trimpath={{.Env.GOPATH}}
    goos:
      - linux
      - darwin
      - windows
    goarch:
      - amd64
      - 386
    ignore:
      - goos: darwin
        goarch: 386
  -
    binary: ccloud-ksql-plugin
    main: ./plugin/ccloud-ksql-plugin
    ldflags:
      - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}}  -X main.host={{.Env.HOSTNAME}}
    gcflags:
      - -trimpath={{.Env.GOPATH}}
    asmflags:
      - -trimpath={{.Env.GOPATH}}
    goos:
      - linux
      - darwin
      - windows
    goarch:
      - amd64
      - 386
    ignore:
      - goos: darwin
        goarch: 386

release:
  disable: true

archive:
  format: binary

s3:
  -
    bucket: confluent.cloud
    region: us-west-2
    folder: "ccloud-cli/{{.Version}}"
    acl: public-read

dockers:
  -
    goos: linux
    goarch: amd64
    binaries:
      - ccloud
      - ccloud-kafka-plugin
#      The world isn't ready for these yet:
#      - ccloud-connct-plugin
#      - ccloud-ksql-plugin
    image_templates:
      - "confluentinc/ccloud-cli:latest"
      - "confluentinc/ccloud-cli:{{ .Tag }}"
      - "confluentinc/ccloud-cli:v{{ .Major }}"
      - "gcr.io/confluentinc/ccloud-cli:latest"
    skip_push: false
